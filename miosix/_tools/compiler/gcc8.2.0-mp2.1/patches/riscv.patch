diff -ruN old_patch/gcc-8.2.0/gcc/config/riscv/miosix-elf.h gcc-8.2.0/gcc/config/riscv/miosix-elf.h
--- old_patch/gcc-8.2.0/gcc/config/riscv/miosix-elf.h	1970-01-01 01:00:00.000000000 +0100
+++ gcc-8.2.0/gcc/config/riscv/miosix-elf.h	2018-11-26 00:24:52.123996615 +0100
@@ -0,0 +1,19 @@
+
+/*
+ * RATIONALE: adding builtin_define to always define _MIOSIX
+ * - when libgcc/libstdc++/newlib are compiled, as there are some #ifdef _MIOSIX
+ * - when Miosix processes are compiled, to allow #ifdef _MIOSIX
+ * Also add versioning to miosix-specific compiler patches.
+ * Note: intentionally breaking compatibility with previous compiler patches
+ * which defined _MIOSIX_GCC_PATCH_VERSION instead of _MIOSIX_GCC_PATCH_MAJOR
+ */
+
+#undef TARGET_OS_CPP_BUILTINS
+#define TARGET_OS_CPP_BUILTINS()         \
+    do {                                 \
+        TARGET_CPU_CPP_BUILTINS();     \
+        builtin_define("_MIOSIX");       \
+        builtin_define("_MIOSIX_GCC_PATCH_MAJOR=2"); \
+        builtin_define("_MIOSIX_GCC_PATCH_MINOR=1"); \
+        builtin_assert("system=miosix"); \
+    } while(false)
diff -ruN old_patch/gcc-8.2.0/gcc/config/riscv/t-riscv-miosix gcc-8.2.0/gcc/config/riscv/t-riscv-miosix
--- old_patch/gcc-8.2.0/gcc/config/riscv/t-riscv-miosix	1970-01-01 01:00:00.000000000 +0100
+++ gcc-8.2.0/gcc/config/riscv/t-riscv-miosix	2018-11-26 00:24:52.123996615 +0100
@@ -0,0 +1,31 @@
+# This file was generated by multilib-generator with the command:
+#  ./multilib-generator rv32i-ilp32--c rv32im-ilp32--c rv32iac-ilp32-- rv32imac-ilp32-- rv32imafc-ilp32f-rv32imafdc- rv64imac-lp64-- rv64imafdc-lp64d--
+#  FIXME: This is copied from t-elf-multilib, but many arch are not needed and can be removed
+MULTILIB_OPTIONS = march=rv32i/march=rv32ic/march=rv32im/march=rv32imc/march=rv32iac/march=rv32imac/march=rv32imafc/march=rv32imafdc/march=rv32gc/march=rv64imac/march=rv64imafdc/march=rv64gc mabi=ilp32/mabi=ilp32f/mabi=lp64/mabi=lp64d
+MULTILIB_DIRNAMES = rv32i \
+rv32ic \
+rv32im \
+rv32imc \
+rv32iac \
+rv32imac \
+rv32imafc \
+rv32imafdc \
+rv32gc \
+rv64imac \
+rv64imafdc \
+rv64gc ilp32 \
+ilp32f \
+lp64 \
+lp64d
+MULTILIB_REQUIRED = march=rv32i/mabi=ilp32 \
+march=rv32im/mabi=ilp32 \
+march=rv32iac/mabi=ilp32 \
+march=rv32imac/mabi=ilp32 \
+march=rv32imafc/mabi=ilp32f \
+march=rv64imac/mabi=lp64 \
+march=rv64imafdc/mabi=lp64d
+MULTILIB_REUSE = march.rv32i/mabi.ilp32=march.rv32ic/mabi.ilp32 \
+march.rv32im/mabi.ilp32=march.rv32imc/mabi.ilp32 \
+march.rv32imafc/mabi.ilp32f=march.rv32imafdc/mabi.ilp32f \
+march.rv32imafc/mabi.ilp32f=march.rv32gc/mabi.ilp32f \
+march.rv64imafdc/mabi.lp64d=march.rv64gc/mabi.lp64d
diff -ruN old_patch/gcc-8.2.0/gcc/config.gcc gcc-8.2.0/gcc/config.gcc
--- old_patch/gcc-8.2.0/gcc/config.gcc	2018-11-26 00:30:22.859630893 +0100
+++ gcc-8.2.0/gcc/config.gcc	2018-11-26 00:29:11.519709381 +0100
@@ -2081,6 +2081,12 @@
 riscv*-*-elf* | riscv*-*-rtems*)
 	tm_file="elfos.h newlib-stdint.h ${tm_file} riscv/elf.h"
 	case ${target} in
+	riscv*-miosix-elf*)
+          # Copy options from riscv*-*-elf*, add the miosix-specific ones
+          tm_file="${tm_file} riscv/miosix-elf.h"  # Append
+          tmake_file="riscv/t-riscv-miosix"     # Replace
+          use_gcc_stdint=wrap
+          ;;
 	*-*-rtems*)
 	  tm_file="${tm_file} rtems.h riscv/rtems.h"
 	  tmake_file="${tmake_file} riscv/t-rtems"
